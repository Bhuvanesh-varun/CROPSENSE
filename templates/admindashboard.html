<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Admin Dashboard - CropSense</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <link rel="icon" type="image/png" href="{{ url_for('static', filename='assets/logo.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

    <!-- ===== SIDEBAR ===== -->
    <div class="sidebar">
        <h4>CropSense Admin</h4>

        <a href="{{ url_for('admin_dashboard', view='users') }}">Users</a>
        <a href="{{ url_for('admin_dashboard', view='logs') }}">Login Logs</a>
        <a href="{{ url_for('admin_dashboard', view='subscribers') }}">Subscribers</a>
        <a href="{{ url_for('index') }}">Go to Website</a>




        <hr style="border-color:#4b5563;">
        <a href="{{ url_for('logout') }}">Logout</a>
    </div>

    <!-- ===== MAIN CONTENT ===== -->
    <div class="content">

        <!-- TOP HEADER -->
        <div class="top-card d-flex justify-content-between align-items-center">
            <h3 class="fw-bold m-0">Admin Dashboard</h3>
            <div>
                <span class="text-secondary me-2">Welcome, Admin</span>
                <a class="btn btn-danger btn-sm px-3" href="{{ url_for('logout') }}">Logout</a>
            </div>
        </div>

        {% if view == 'users' %}
        <!-- USERS TABLE -->
        <h3 class="fw-bold mb-3">Users</h3>
        <table class="table table-hover">
            <thead class="table-dark">
                <tr>
                    <th>User No</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Role</th>
                </tr>
            </thead>
            <tbody>
                {% for u in users %}
                <tr>
                    <td>{{ u.user_number }}</td>
                    <td>{{ u.name }}</td>
                    <td>{{ u.email }}</td>
                    <td>{{ u.role }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}


        {% if view == 'logs' %}
        <h3 class="fw-bold mb-3">Login Logs</h3>
        <table class="table table-bordered table-striped">
            <thead class="table-dark">
                <tr>
                    <th>Timestamp</th>
                    <th>Email</th>
                    <th>User ID</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for log in logs %}
                <tr>
                    <td>{{ log.timestamp }}</td>
                    <td>{{ log.email }}</td>
                    <td>{{ log.user_id }}</td>
                    <td>
                        {% if log.event == "login" %}
                        <span class="badge bg-success">Success</span>
                        {% else %}
                        <span class="badge bg-danger">Failed</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}


        {% if view == 'subscribers' %}

        <h2 class="fw-bold my-5">Subscription Users</h2>

        <!-- FREE USERS -->
        <h4 class="text-secondary mt-4">Free Users</h4>
        <div class="table-responsive">
            <table class="table table-bordered table-striped">
                <thead class="table-light">
                    <tr>
                        <th>User ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Plan</th>
                    </tr>
                </thead>
                <tbody>
                    {% for u in free_users %}
                    <tr>
                        <td>{{ u.uid }}</td>
                        <td>{{ u.name }}</td>
                        <td>{{ u.email }}</td>
                        <td>{{ u.plan }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- BASIC USERS -->
        <h4 class="text-success mt-4">Basic Subscribers (₹99)</h4>
        <div class="table-responsive">
            <table class="table table-bordered table-striped">
                <thead class="table-success">
                    <tr>
                        <th>User ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for u in basic_users %}
                    <tr>
                        <td>{{ u.uid }}</td>
                        <td>{{ u.name }}</td>
                        <td>{{ u.email }}</td>
                        <td>{{ u.date }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- STANDARD USERS -->
        <h4 class="text-primary mt-4">Standard Subscribers (₹199)</h4>
        <div class="table-responsive">
            <table class="table table-bordered table-striped">
                <thead class="table-primary">
                    <tr>
                        <th>User ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for u in standard_users %}
                    <tr>
                        <td>{{ u.uid }}</td>
                        <td>{{ u.name }}</td>
                        <td>{{ u.email }}</td>
                        <td>{{ u.date }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- PREMIUM USERS -->
        <h4 class="text-warning mt-4">Premium Subscribers (₹399)</h4>
        <div class="table-responsive">
            <table class="table table-bordered table-striped">
                <thead class="table-warning">
                    <tr>
                        <th>User ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for u in premium_users %}
                    <tr>
                        <td>{{ u.uid }}</td>
                        <td>{{ u.name }}</td>
                        <td>{{ u.email }}</td>
                        <td>{{ u.date }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {% endif %}


    </div>

    <!-- SCRIPT -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const view = new URLSearchParams(window.location.search).get("view");

        document.querySelector(".users-section").style.display = "none";
        document.querySelector(".logs-section").style.display = "none";
        document.querySelector(".subscribers-section").style.display = "none";

        if (view === "logs") {
            document.querySelector(".logs-section").style.display = "block";
        } else if (view === "subscribers") {
            document.querySelector(".subscribers-section").style.display = "block";
        } else {
            document.querySelector(".users-section").style.display = "block";
        }
    </script>

</body>

</html>